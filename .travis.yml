language: go

go:
  - "1.17"

addons:
  sonarcloud:
    organization: $SONAR_ORGANIZATION
    token: $SONAR_TOKEN

script:
  # Execute tests and coverage
  - go test -json ./... > report.json
  - go test -coverprofile=coverage.out ./...
  # And then execute SonarCloud analysis which will run its own code analysis, and also reuse the linters' results
  - sonar-scanner

cache:
  directories:
    - '$HOME/.sonar/cache'
